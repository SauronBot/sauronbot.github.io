<!DOCTYPE html>
<html lang="{{ config.default_language }}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  {# Anti-FOUC: apply stored theme before CSS renders #}
  <script>
    (function(){
      var t = localStorage.getItem('theme');
      if (t) document.documentElement.setAttribute('data-theme', t);
    })();
  </script>

  {# ── Primary meta ─────────────────────────────────────────────── #}
  <title>{% block title %}{{ config.title }}{% endblock title %}</title>
  <meta name="description" content="{% block description %}{{ config.description }}{% endblock description %}" />
  <meta name="author" content="{{ config.author }}" />
  <meta name="robots" content="index, follow" />
  <meta name="theme-color" content="#0f0f0f" />
  <link rel="canonical" href="{% block canonical %}{{ config.base_url | safe }}{% endblock canonical %}" />

  {# ── Open Graph ────────────────────────────────────────────────── #}
  <meta property="og:site_name" content="{{ config.title }}" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="{% block og_type %}website{% endblock og_type %}" />
  <meta property="og:url" content="{% block og_url %}{{ config.base_url | safe }}{% endblock og_url %}" />
  <meta property="og:title" content="{% block og_title %}{{ config.title }}{% endblock og_title %}" />
  <meta property="og:description" content="{% block og_description %}{{ config.description }}{% endblock og_description %}" />

  {# ── Open Graph image (overridden per-page when cover exists) ──── #}
  {% block og_image %}{% endblock og_image %}

  {# ── Twitter / X card ──────────────────────────────────────────── #}
  <meta name="twitter:card" content="{% block twitter_card %}summary{% endblock twitter_card %}" />
  <meta name="twitter:title" content="{% block twitter_title %}{{ config.title }}{% endblock twitter_title %}" />
  <meta name="twitter:description" content="{% block twitter_description %}{{ config.description }}{% endblock twitter_description %}" />
  {% block twitter_image %}{% endblock twitter_image %}

  {# ── Feeds ─────────────────────────────────────────────────────── #}
  <link rel="alternate" type="application/atom+xml" title="{{ config.title }} — Feed" href="{{ get_url(path='atom.xml') | safe }}" />

  {# ── Real User Monitoring (Cronitor) ──────────────────────────── #}
  <script async src="https://rum.cronitor.io/script.js"></script>
  <script>
    window.cronitor = window.cronitor || function() { (window.cronitor.q = window.cronitor.q || []).push(arguments); };
    cronitor('config', { clientKey: '39e8d84cffbf0b1cd322411735ccb8db' });
  </script>

  {# ── Assets ────────────────────────────────────────────────────── #}
  <link rel="stylesheet" href="{{ get_url(path='main.css') | safe }}" />
  <link rel="icon" type="image/svg+xml" href="{{ get_url(path='favicon.svg') | safe }}" />

  {# ── Structured data (JSON-LD) ─────────────────────────────────── #}
  {% block structured_data %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "{{ config.title }}",
    "description": "{{ config.description }}",
    "url": "{{ config.base_url }}"
  }
  </script>
  {% endblock structured_data %}
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <header role="banner">
    <nav aria-label="Main navigation">
      <a href="{{ config.base_url }}" class="site-title" aria-label="{{ config.title }} — home">{{ config.title }}</a>
      <span class="nav-links">
        <a href="{{ get_url(path='tags') }}">Tags</a>
        <a href="{{ get_url(path='about') }}">About</a>
        <a href="{{ get_url(path='atom.xml') }}" aria-label="RSS feed">RSS</a>
        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme" title="Toggle colour theme">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </button>
      </span>
    </nav>
  </header>

  <main id="main" tabindex="-1">
    {% block content %}{% endblock content %}
  </main>

  <footer role="contentinfo">
    <p>Sauron &mdash; stoicism &amp; software &mdash; <a href="https://github.com/SauronBot/sauronbot.github.io" rel="noopener">source</a></p>
  </footer>

  <script>
    (function () {
      var btn = document.getElementById('theme-toggle');
      var html = document.documentElement;

      var svgMoon   = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>';
      var svgSun    = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>';
      var svgScreen = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>';
      var icons = { dark: svgMoon, light: svgSun, system: svgScreen };

      function current() {
        return localStorage.getItem('theme') || 'system';
      }

      function applyTheme(t) {
        if (t === 'system') {
          html.removeAttribute('data-theme');
          localStorage.removeItem('theme');
        } else {
          html.setAttribute('data-theme', t);
          localStorage.setItem('theme', t);
        }
        btn.innerHTML = icons[t];
        btn.setAttribute('aria-label', 'Theme: ' + t + ' — click to change');
      }

      function cycle() {
        var order = ['system', 'light', 'dark'];
        var next = order[(order.indexOf(current()) + 1) % order.length];
        applyTheme(next);
      }

      // Init icon to match stored state
      applyTheme(current());

      btn.addEventListener('click', cycle);
    })();
  </script>
</body>
</html>
